### 개발환경 구성

Cloud9 IDE 을 생성하고, 필요한 환경을 구성합니다.

1. AWS 계정에 로그인 한 다음, Cloud9 서비스를 선택 합니다.
    <img src="./media/../../media/select_cloud9.png">

2. Environment 버튼을 선택합니다.
    <img src="./media/../../media/click_environment.png">

3. AWS 클라우드 콘솔에 로그인하고 Cloud9 서비스 페이지로 이동하여 아래와 스펙과 동일하게 Cloud9 IDE 인스턴스를 생성한다.
    - EC2 instance type : t2.micro
    - Memory : 1GB
    - CPU : 1vCPU
    - OS : ubuntu 18
4. 다음으로 CodeCommit 페이지로 이동하여, 코드의 버전을 관리하기 위한 Repository 를 생성한다.
   - repository name : aws-serverless-ecommerce-front-store
    
5. 앞서 생성한 Cloud9 IDC 인스턴스에 접속하고, 터미널 창에서 앞에 생성한 git repository 를 Clone 한다.
6. Vue 프로젝트를 손쉽게 생성하기 위해, vue CLI(Command Line Interface)를 설치한다. (설치 명령어는 아래 참고)

    ```
    heejonglee:~/environment $ npm install -g @vue/cli
    ```

7. 설치된 vue 명령어를 이용하여, 프로젝트를 생성한다. 설치 옵션으로 Vuex 와 Router 를 선택한다.

    ```
    heejonglee:~/environment $ mkdir src
    heejonglee:~/environment $ cd src
    heejonglee:~/environment $ vue create forntend-store 
    ```

8. Cloud9 환경에서 webpack 으로 빌드되는 애플리케이션을 빌드 하고, 페이지에 접근 하는 경우  Invalid Header 가 발생한다. 해당 문제를 해결하기 위해서 package.json 디렉토리와 동일 한 위치에 vue.config.js 파일을 생성하고 아래 내용을 추가하면, 해당 문제를 해결 할 수 있다.

    ```
    module.exports = {
    devServer: {
      disableHostCheck: true
    },
    // ... other options
    }
    // In order to disable the hostcheck
    ```

9.  다음과 같이 명령어를 실행하여, vue application 이 정상적으로 실행되는지 확인한다.
    ```
    heejonglee:~/environment $ npm run serve 
    ```
10. 정상적으로 동작이 확인 되면, 지금까지 코드를 CodeCommit 에 Push 한다.


### Amplify 환경 구성 하기 

1. 가장 먼저 Amplify CLI(Command Line Interface)를 설치한다.
    ```
    heejonglee:~/environment $ npm install -g @aws-amplify/cli
    
    ..(생략)..

    heejonglee:~/environment $ amplify -v
    Scanning for plugins...
    Plugin scan successful
    4.13.4
    heejonglee:~/environment 
    ```

2. Cloud9 셋팅을 변경한다. (Amplify 에서 Cloud9 이 가지고 있는 ACCESS_KEY_ID를 사용하는 경우, amplify init 명령어를 실행하는 시점에 오류가 발생함) 메뉴에서 AWS Cloud9 에 Preference 를 선택하고, AWS Settings 에서 **AWS Managed temporary credential** 을 **disable** 한다. 

3. AWS Console 에서 새로운 ACCESS_KEY_ID 와 secretAccessKey를 생성하고, 다운로드 한다.

4. Amplify CLI 에서 사용하기 위한 aws profile 설정한다. accessKeyId, secretAccessKey 를 앞서 생성한 정보로 입력한다.

    ```    
    frontend-store (master) $ amplify configure
    Follow these steps to set up access to your AWS account:
    
    Sign in to your AWS administrator account:
    https://console.aws.amazon.com/
    Press Enter to continue
    
    Specify the AWS Region
    ? region:  ap-northeast-2
    Specify the username of the new IAM user:
    ? user name:  heejonglee
    Complete the user creation using the AWS console
    https://console.aws.amazon.com/iam/home?region=undefined#/users$new?step=final&accessKey&userNames=heejonglee&permissionType=policies&policies=arn:aws:iam::aws:policy%2FAdministratorAccess
    Press Enter to continue
    
    Enter the access key of the newly created user:
    ? accessKeyId:  AKIA3OOCKB**********
    ? secretAccessKey:  i1asijPXEpyYUpB/Tkva********************
    This would update/create the AWS Profile in your local machine
    ? Profile Name:  amplify
    
    * 참고: https://github.com/aws-samples/amplify-photo-gallery-workshop/issues/3
    ```

5. 프로젝트 디렉토리로 이동하고, amplify init 을 통해 amplify 애플리케이션 필요한 환경을 구성한다.
    ```
    heejonglee:~/environment $ cd aws-serverless-ecommerce-front-store 
    heejonglee:~/environment/aws-serverless-ecommerce-front-store (master) $ amplify init
    Note: It is recommended to run this command from the root of your app directory
    ? Enter a name for the project frontend-store
    ? Enter a name for the environment dev
    ? Choose your default editor: None
    ? Choose the type of app that you're building javascript
    Please tell us about your project
    ? What javascript framework are you using vue
    ? Source Directory Path:  src
    ? Distribution Directory Path: dist
    ? Build Command:  npm run-script build
    ? Start Command: npm run-script serve
    Using default provider  awscloudformation
    
    For more information on AWS Profiles, see:
    https://docs.aws.amazon.com/cli/latest/userguide/cli-multiple-profiles.html
    
    ? Do you want to use an AWS profile? Yes
    ? Please choose the profile you want to use amplify
    Adding backend environment dev to AWS Amplify Console app: db1daurslfdzj
    ⠦ Initializing project in the cloud...
    
    CREATE_IN_PROGRESS amplify-frontend-store-dev-40048 AWS::CloudFormation::Stack Tue Feb 25 2020 04:00:49 GMT+0000 (Coordinated Universal Time) User Initiated    >         
    CREATE_IN_PROGRESS UnauthRole                       AWS::IAM::Role             Tue Feb 25 2020 04:00:52 GMT+0000 (Coordinated Universal Time)                            
    CREATE_IN_PROGRESS AuthRole                         AWS::IAM::Role             Tue Feb 25 2020 04:00:52 GMT+0000 (Coordinated Universal Time)                            
    CREATE_IN_PROGRESS DeploymentBucket                 AWS::S3::Bucket            Tue Feb 25 2020 04:00:53 GMT+0000 (Coordinated Universal Time)                            
    CREATE_IN_PROGRESS UnauthRole                       AWS::IAM::Role             Tue Feb 25 2020 04:00:53 GMT+0000 (Coordinated Universal Time) Resource creation Initiated
    CREATE_IN_PROGRESS DeploymentBucket                 AWS::S3::Bucket            Tue Feb 25 2020 04:00:54 GMT+0000 (Coordinated Universal Time) Resource creation Initiated
    CREATE_IN_PROGRESS AuthRole                         AWS::IAM::Role             Tue Feb 25 2020 04:00:54 GMT+0000 (Coordinated Universal Time) Resource creation Initiated
    ⠴ Initializing project in the cloud...
    
    CREATE_COMPLETE UnauthRole AWS::IAM::Role Tue Feb 25 2020 04:01:10 GMT+0000 (Coordinated Universal Time) 
    CREATE_COMPLETE AuthRole   AWS::IAM::Role Tue Feb 25 2020 04:01:11 GMT+0000 (Coordinated Universal Time) 
    ⠧ Initializing project in the cloud...
    
    CREATE_COMPLETE DeploymentBucket                 AWS::S3::Bucket            Tue Feb 25 2020 04:01:15 GMT+0000 (Coordinated Universal Time) 
    CREATE_COMPLETE amplify-frontend-store-dev-40048 AWS::CloudFormation::Stack Tue Feb 25 2020 04:01:18 GMT+0000 (Coordinated Universal Time) 
    ✔ Successfully created initial AWS cloud resources for deployments.
    ✔ Initialized provider successfully.
    Initialized your environment successfully.
    
    Your project has been successfully initialized and connected to the cloud!
    
    Some next steps:
    "amplify status" will show you what you've added already and if it's locally configured or deployed
    "amplify add <category>" will allow you to add features like user login or a backend API
    "amplify push" will build all your local backend resources and provision it in the cloud
    “amplify console” to open the Amplify Console and view your project status
    "amplify publish" will build all your local backend and frontend resources (if you have hosting category added) and provision it in the cloud
    
    Pro tip:
    Try "amplify add api" to create a backend API and then "amplify publish" to deploy everything
    
    heejonglee:~/environment/aws-serverless-ecommerce-front-store/frontend-store (master) $ 
    ```

7. AWS 클라우드 콘솔에 접속하면, 위 클라우드 포메이션 스택에 대한 결과를 확인 할 수 있다. congito 를 사용할 하는 Role 및 애플리케이션 배포에 필요한 S3 버킷이 생성된 것을 볼 수 있다.

    ```
    AuthRole : cognito role
    DeploymentBucket : deploymnent s3 bucket
    UnauthRole : cognito role
    ```
 
8. 지금까지 작업 된 애플리케이션 소스코드를 Git Repository 에 Push 한다.push to git repository
    
    ** push 과정 중에 403 오류가 발생하는 경우 아래 명령어를 참고 한다.
    ```
    # credential 은 repository 에 접속하기 위한 인증정보이며, 해당 정보를 초기화 함
    git config --global --unset credential.helper

    # 아래와 같이 push 를 하게 되는 경우, username, password 를 묻게되고, IAM 을 통해서 Code Commit에 접속하기 위한
    # username, password 를 다시 생성함.

    git push -U origin master
    
    # 매번 username, password 를 입력할 수 없으므로, 방금 인증된 정보를 저장함.
    git config --global credential.helper store
    ```